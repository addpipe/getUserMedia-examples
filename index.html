<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>getUserMedia Examples - addpipe.com</title>
    <meta name="description" content="getUserMedia code and constraints examples">
    <link rel="stylesheet" href="css/atom-one-dark.min.css">
    <script src="js/highlight.min.js"></script>
  
    <!-- Plausible Analytics -->
    <script defer data-domain="addpipe.com" src="https://plausible.io/js/script.js"></script>
  
    <style>
        body {
            line-height: 1.5;
            font-family: sans-serif;
            word-wrap: break-word;
            overflow-wrap: break-word;
            color:black;
            margin:2em;
        }

        h1 {
            text-decoration: underline red;
            text-decoration-thickness: 3px;
            text-underline-offset: 6px;
            font-size: 220%;
            font-weight: bold;
        }

        h2 {
            font-weight: bold;
            color: #005A9C;
            font-size: 140%;
            text-transform: uppercase;
        }

        p {
            margin: 1em 0;
        }

        pre {
            padding: 0px;
            border:0px;
            border-radius: 0px;
        }

        red {
            color: red;
        }

        .example-section {
            padding: 25px 0;
        }

        .table-of-contents{
            padding: 0 5px;
        }

        .table-of-contents li {
            list-style: none;
        }

        button {
            flex-grow: 1;
            height: 3rem;
            min-width: 10rem;
            border: none;
            border-radius: 0.15rem;
            background: #ed341d;
            margin-left: 2px;
            box-shadow: inset 0 -0.15rem 0 rgba(0, 0, 0, 0.2);
            cursor: pointer;
            color: #ffffff;
            font-weight: bold;
            font-size: 1rem;
            margin-bottom: 5px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        video, canvas {
            max-width: 100%;
            border-radius: 5px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            margin: 10px 0;
            background: #000;
        }

        .controls {
            margin: 15px 0;
            padding: 15px;
            border-radius: 10px;
        }

        select, input {
            padding: 8px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            margin: 5px;
            font-size: 14px;
        }

        .error {
            color: #e53e3e;
            background: #fed7d7;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #e53e3e;
        }

        .info {
            color: black;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid black;
        }

        .status {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: bold;
        }

        .status.recording {
            background: #fed7d7;
            color: #c53030;
            animation: pulse 2s infinite;
        }

        .status.stopped {
            background: #c6f6d5;
            color: #22543d;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>getUserMedia Examples </h1>
    <p class="description">Made by the <a href="https://addpipe.com" target="_blank">Pipe Video Recording Platform</a></p>
    
    <p class="description">These examples demonstrate the powerful <a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia" target="_blank"><code>getUserMedia</code> method</a>, which gives web applications secure access to cameras and microphones. To run <code>getUserMedia</code>, your web page needs to be in a <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts" target="_blank">secure context</a>, the page must not be under a <a href="https://blog.addpipe.com/camera-and-microphone-access-in-cross-oirigin-iframes-with-feature-policy/" target="_blank">Permissions Policy</a> that's limiting device access, and you need to have user permission at the browser level and, in some cases, at the operating system level. When first run, the browser will prompt for permissions, and you can manage these settings through browser preferences or OS privacy controls. 
    <p>Originally part of WebRTC, <code>getUserMedia</code> has now become essential for tasks such as video recording, audio recording, taking pictures, and enumerating available devices.</p>
    <p>The examples below showcase how <code>getUserMedia</code> enables a range of key scenarios, making it a vital tool for modern web applications.</p>
    
    <h2>table of contents </h2>
    <ul class="table-of-contents">
        <li><a href="#videoAndAudio">Example 1: Capture Audio and Video</a></li>
        <li><a href="#stoppingTheStream">Example 2: Stop Device Access</a></li>
        <li><a href="#audioOnlyConstraint">Example 3: Audio Only Constraint</a></li>
        <li><a href="#videoOnlyConstraint">Example 4: Video Only Constraint</a></li>
        <li><a href="#listingSpecificDevice">Example 5: List Available Devices</a></li>
        <li><a href="#recordingClip">Example 6: Recording a Video Clip (MediaRecorder)</a></li>
        <li><a href="#captureVideo">Example 7: Capture Video + Take a Snapshot</a></li>
        <li><a href="#requestAnAspectRatio">Example 8: Requesting a Certain Aspect Ratio</a></li>
        <li><a href="#requestPortraitVideoStream">Example 9: Requesting a Portrait Video Stream With facingMode:user</a></li>
        <li><a href="#basicVideoPreview">Example 10: Basic Video Preview </a></li>
        <li><a href="#asyncPlusAudioOnly">Example 11: Async/Await + Audio Only</a></li>
    </ul>
    <br />
    <br />

<h4 id="videoAndAudio">🎥🎤 Example 1: Capture Audio and Video</h4>
<p>This example demonstrates the basic use of the <code>getUserMedia</code> method to access both the user's camera and microphone simultaneously. The code requests permission for both video and audio streams using the <code>{ video: true, audio: true }</code> constraint, then creates a video element that displays the camera stream in real-time. </p>
<pre><code class="example">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="utf-8"&gt;
    &lt;title&gt;Capture Audio and Video&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;video id="video" autoplay playsinline&gt; &lt;/video&gt;
    &lt;script&gt;
        navigator.mediaDevices.getUserMedia({ video: true, audio: true })
        .then(stream => {
            const video = document.createElement('video');
            video.autoplay = true;
            video.srcObject = stream;
            document.body.appendChild(video);
        })
        .catch(error => {
            console.error('Error accessing camera and microphone:', error);
        });
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

<p>Key points:</p>
<ul>
    <li>Uses <code>{ video: true, audio: true }</code> to request both camera and microphone access;</li>
    <li>Creates a video element with autoplay to display the stream from the camera;</li>
    <li>Includes basic error handling with <code>.catch()</code> for permission denials or device issues.</li>
</ul>
<br />
<br />
<h4 id="stoppingTheStream">🛑 Example 2: Stop Device Access</h4>
<p>Demonstrates how to properly stop media streams by calling <code>getTracks().forEach(track => track.stop())</code> on the stream object. This is essential for releasing camera and microphone resources when they're no longer needed.</p>
<pre><code class="example">&lt;script&gt;
    stream.getTracks().forEach(track => track.stop());
&lt;/script&gt;
</code></pre>
<p>Key points:</p>
<ul>
    <li>Essential for freeing up camera/microphone for other applications;</li>
    <li>Should always be called when device access is no longer needed;</li>
    <li>iOS, Android, and macOS will show a green dot prominently when the camera is accessed.</li>
</ul>
<br />
<br />
<h4 id="audioOnlyConstraint">🎤 Example 3: Audio Only Constraint</h4>
<p>Shows how to request access to only the microphone using <code>{ audio: true }</code> without requesting video. </p>
<pre><code class="example">&lt;script&gt;
    navigator.mediaDevices.getUserMedia({ audio: true })
    .then(stream => {
        console.log('Microphone access granted');
    })
    .catch(error => {
        console.error('Error accessing microphone:', error);
    });
&lt;/script&gt;
</code></pre>
<p>Key points:</p>
<ul>
    <li>Logs success message to console when microphone permission is granted;</li>
    <li>Useful for voice recording or audio chat applications.</li>
</ul>
<br />
<br />
<h4 id="videoOnlyConstraint">📸 Example 4: Video Only Constraint</h4>
<p>Demonstrates requesting access to only the camera using <code>{ video: true }</code> without audio. </p>
<pre><code class="example">&lt;script&gt;
    navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => {
      const video = document.getElementById('video');
      video.srcObject = stream;
    })
    .catch(error => {
      console.error('Error accessing camera:', error);
    });
&lt;/script&gt;
</code></pre>
<p>Key points:</p>
<ul>
    <li>Suitable for applications that need only camera access like taking photos or scanning QR codes.</li>
</ul>
<br />
<br />
<h4 id="listingSpecificDevice">🔍 Example 5: List Available Devices</h4>
<p>Uses <code>navigator.mediaDevices.enumerateDevices()</code> to list all available media input devices (cameras and microphones) on the user's system and get their device ID.</p>
<pre><code class="example">&lt;script&gt;
    navigator.mediaDevices.enumerateDevices().then(devices => {
        devices.forEach(device => {
            console.log(device.kind + ": " + device.label + " id = " + device.deviceId);
        });
    });
&lt;/script&gt;
</code></pre>
<p>Key points:</p>
<ul>
    <li>Logs device kind, label, and deviceId for each camera and microphone;</li>
    <li>Helpful for giving users acess to a custom made device selection UI.</li>
</ul>
<br />
<br />
<h4 id="recordingClip">📸 Example 6: Recording a Video Clip (MediaRecorder)</h4>
<p>Shows how to record video and audio using the <code>MediaRecorder</code> interface of the <code>MediaStream Recording API</code>.</p>
<pre><code class="example">&lt;video id="preview" autoplay playsinline width="320" height="240"&gt;&lt;/video&gt;
    &lt;button id="record">Start Recording&lt;/button&gt;
    &lt;button id="stop" disabled>Stop & Download&lt;/button&gt;
    
    &lt;script&gt;
        const videoEl = document.getElementById('preview'),
        recordBtn = document.getElementById('record'),
        stopBtn   = document.getElementById('stop');
    
        let recorder, recordedChunks = [];
    
        // 1. Get both video and audio
        navigator.mediaDevices.getUserMedia({ video: true, audio: true })
        .then(stream => {
        videoEl.srcObject = stream;
    
        // 2. Setup MediaRecorder
        recorder = new MediaRecorder(stream);
        recorder.ondataavailable = e => {
            if (e.data && e.data.size > 0) {
            recordedChunks.push(e.data);
            }
        };
    
        recorder.onstop = () => {
            // Create a Blob from recorded chunks
            const blob = new Blob(recordedChunks, { type: 'video/webm' });
            const url  = URL.createObjectURL(blob);
    
            // Create download link
            const a = document.createElement('a');
            a.style.display = 'block';
            a.href = url;
            a.download = 'capture.webm';
            a.textContent = 'Download recording';
            document.body.appendChild(a);
            };
        })
        .catch(console.error);
    
        // 3. Wire up buttons
        recordBtn.addEventListener('click', () => {
            recordedChunks = [];
            recorder.start();
            recordBtn.disabled = true;
            stopBtn.disabled   = false;
        });
    
        stopBtn.addEventListener('click', () => {
            recorder.stop();
            recordBtn.disabled = false;
            stopBtn.disabled   = true;
        });
    &lt;/script&gt;
</code></pre>
<p>Key points:</p>
<ul>
    <li>Grabs audio + video;</li>
    <li>Pipes it to a &lt;video&gt; for live preview;</li>
    <li>Uses <code>MediaRecorder</code> to capture chunks;</li>
    <li>When stopped, bundles into a <code>.webm</code> and offers a download link.</li>
</ul>
<br />
<br />
<h4 id="captureVideo">📸 Example 7: Capture Video + Take a Snapshot</h4>
<p>Combines live video preview with snapshot functionality using HTML5 canvas. </p>
<pre><code class="example">&lt;video id="cam" autoplay playsinline width="320" height="240">&lt;/video&gt;
&lt;button id="snap">Take Snapshot&lt;/button&gt;
&lt;canvas id="photo" width="320" height="240">&lt;/canvas&gt;

&lt;script&gt;
    const video = document.getElementById('cam');
    const canvas = document.getElementById('photo');
    const snapBtn = document.getElementById('snap');
    const ctx = canvas.getContext('2d');

    navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } })
    .then(stream => {
        video.srcObject = stream;
    })
    .catch(console.error);

    snapBtn.addEventListener('click', () => {
    // Draw current video frame onto canvas
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    });
&lt;/script&gt;
</code></pre>
<p>Highlights:</p>
<ul>
    <li><code>facingMode: "user"</code> requests the front-facing camera on devices that support it;</li>
    <li>Snapshot uses &lt;canvas&gt;’s drawImage() to “freeze” the current video frame.</li>
</ul>
<br />
<br />
<h4 id="requestAnAspectRatio">📸 Example 8: Requesting a Certain Aspect Ratio (Square)</h4>
<p>Shows how to request a specific aspect ratio (1:1) from the camera using the <code>aspectRatio</code> constraint and displays the actual achieved dimensions.</p>
<pre><code class="example">&lt;script&gt;
    const videoElem = document.getElementById('preview');
    const infoElem  = document.getElementById('info');

    async function startCamera() {
      try {
        // Desired aspect ratio: 1:1 (square)
        const desiredRatio = 1 / 1;

        const stream = await navigator.mediaDevices.getUserMedia({
          video: {
            aspectRatio: { ideal: desiredRatio }
          }
        });

        videoElem.srcObject = stream;

        // Inspect actual settings
        const track = stream.getVideoTracks()[0];
        const settings = track.getSettings();
        infoElem.textContent = 
          `Got ${settings.width}×${settings.height} ` +
          `(aspectRatio: ${settings.aspectRatio.toFixed(2)})`;
      } catch (err) {
        console.error('Error opening camera:', err);
        infoElem.textContent = 'Unable to access camera with desired aspect ratio.';
      }
    }
    startCamera();
&lt;/script&gt;
</code></pre>
<p>Key points:</p>
<ul>
    <li>Specifies desired aspect ratio with <code>aspectRatio: { ideal: 1/1 }</code>;</li>
    <li>Displays actual achieved resolution using <code>track.getSettings()</code>.</li>
</ul>
<br />
<br />
<h4 id="requestPortraitVideoStream">📱 Example 9: Requesting a Portrait Video Stream With facingMode:user</h4>
<p>Demonstrates capturing video in portrait orientation using the front-facing camera by specifying <code>facingMode: "user"</code> and swapped width/height dimensions (720x1280).</p>
<pre><code class="example">&lt;script&gt;
    navigator.mediaDevices.getUserMedia({
        video: {
        width: { ideal: 720 },
        height: { ideal: 1280 }, 
        facingMode: "user" 
        },
        audio: false
    })
    .then(stream => {
        const video = document.getElementById('video');
        video.srcObject = stream;
    })
    .catch(error => {
        console.error('Error accessing camera:', error);
    });
&lt;/script&gt;
</code></pre>
<p>Key points:</p>
<ul>
    <li>Swaps dimensions (720×1280) to achieve portrait orientation;</li>
    <li>Disables audio with <code>audio: false</code> for video-only capture.</li>
</ul>
<br />
<br />
<h4 id="basicVideoPreview"> 🎥 Example 10: Basic Video Preview (Promise-based)</h4>
<p>A simple example showing how to display a live video preview from the camera using promise-based <code>getUserMedia</code> with basic error handling.</p>
<pre><code class="example">&lt;video id="preview" autoplay playsinline width="640" height="480"&gt;&lt;/video&gt;
&lt;script&gt;
    const videoEl = document.getElementById('preview');

    navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
        // Attach the stream to the video element
        videoEl.srcObject = stream;
        })
        .catch(err => {
        console.error('Error accessing camera:', err);
        });
&lt;/script&gt;
</code></pre>
<p>What it does:</p>
<ul>
    <li>Requests camera access;</li>
    <li>If granted, pipes the live video into the &lt;video&gt; element;</li>
    <li>Handles errors (e.g. user denies permission).</li>
</ul>
<br />
<br />
<h4 id="asyncPlusAudioOnly">🎤 Example 11: Async/Await + Audio Only</h4>
<p>Shows modern async/await syntax for accessing the microphone, with start/stop buttons to control audio capture</p>
<pre><code class="example">&lt;button id="start"&gt;Start Mic&lt;/button&gt;
&lt;button id="stop" disabled&gt;Stop Mic&lt;/button&gt;
&lt;audio id="player" controls&gt;&lt;/audio&gt;

&lt;script&gt;
    const startBtn = document.getElementById('start');
    const stopBtn  = document.getElementById('stop');
    const player   = document.getElementById('player');
    let mediaStream;

    startBtn.addEventListener('click', async () => {
    try {
        mediaStream = await navigator.mediaDevices.getUserMedia({ audio: true });
        player.srcObject = mediaStream;
        startBtn.disabled = true;
        stopBtn.disabled = false;
    } catch (err) {
        console.error('Microphone access error:', err);
    }
    });

    stopBtn.addEventListener('click', () => {
    // Stop all audio tracks
    mediaStream.getTracks().forEach(track => track.stop());
    startBtn.disabled = false;
    stopBtn.disabled = true;
    });
&lt;/script&gt;
</code></pre>
<p>Key points:</p>
<ul>
    <li>Uses <code>async/await</code> for cleaner control flow;</li>
    <li>Demonstrates enabling/disabling controls and stopping tracks.</li>
</ul>
<br />
<br />
    <script>hljs.initHighlightingOnLoad();</script>
</body>
</html>